<!DOCTYPE HTML>
<html>
	<head>
		<meta charset="utf-8"/>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
		<meta name="HandheldFriendly" content="true"/>
		<meta name="MobileOptimized" content="320"/>
		<title>Hello H5+</title>
		<script src="js/config.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/zepto.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/fx.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/template.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript" src="js/fastclick.js" ></script>
		<script src="js/common.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript" charset="utf-8">
		 
		var commentArr =new Array( '很差','一般','好','很好','非常好')
		var ADDRComment = {
			init:function(data){
				this.bindEvent();
				this.renderHead(data);
			},
			renderHead : function(data){
				$('.comment-head').html(data.name);
				$('#addr_id').val(data.id)
			},
			bindEvent : function(){
				window.back=function(){
					ws=plus.webview.currentWebview();
					if(window.plus){
						ws.close();
					}else if(history.length>1){
						history.back();
					}else{
						window.close();
					}
				};
				plus.key.addEventListener("backbutton",function(){
					back();
				},false);
				$(".submit-comment").on("click",function(){
					ADDRComment.setData();
				});
				$(".comment-star").on('click',function(e){
					var index =$(e.target).val();
					$('li').attr('class','');
					var li = $('li');
					for(var i=0;i<index;i++){
						li[i].className="active";
					}
					$('.star-tip').html(commentArr[i-1]);
					$('#star').val(index);
				});
			},
			setData : function(){
				var id =$('#addr_id').val(),
					commentText=$('#comment-text').val(),
					start=$('#star').val(),
				 	date = new Date().getTime(),
				 	url=encodeURI(CONF.apiServer+'/?method=setAddrComment&addr_id='+id+"&comment="+commentText+"&time="+date+"&start="+start),
				 	ajax = new plus.net.XMLHttpRequest();
				 	
					ajax.onreadystatechange = function () {
					if(ajax.readyState==4&&ajax.status == 200){
						if(plus.os.name=="iOS"){
							alert('添加评论成功');
						}else{
							plus.nativeUI.toast('添加评论成功');
						}
						back();
					}
				}
				ajax.open("GET",url);
				
				ajax.send();
			}
		}
		function plusReady(){
			
		}
		
		function commentPageInit(data){
			$(function(){
				FastClick.attach(document.body);
			if(window.plus){
				ADDRComment.init(data);
			}else{
				document.addEventListener("plusready",function(){ADDRComment.init(data)},false);
			}
		})	
		}
		
		</script>
		<link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8"/>
		<link rel="stylesheet" type="text/css" href="css/addr-comment.css"/>
	</head>
	<body>
		<header>
			<div class="nvbt iback-cancel" onclick="back();"></div>
			<div class="nvtt comment-head">test</div>
			<div class="nvbt btn-nav-submit submit-comment">提交</div>
		</header>
		
	<div class="wrap">
		<div class="info-content">
			
		</div>
		<div class="info">
		
		</div>
		<div class="info-content info-foot submit-comment">
			<a class="add" id="comment" style="margin: 0 auto;margin-bottom: 10px;margin-left: 25%;border-radius: 5px;" href="javascript:;">提交评价</a>	
		</div>
	</div>
	<div class="comment-detail" data-id="" data-name="">
	        <div class="comment-row">
	            <div class="comment-content">
	                <div class="star-wrapper">
	                    <ul class="comment-star" data-node="comment-star">
	                        <li value="1" class="active"></li>
	                        <li value="2" class=""></li>
	                        <li value="3" class=""></li>
	                        <li value="4" class=""></li>
	                        <li value="5" class=""></li>
	                    </ul>
	                </div>
	                <span class="star-tip">点击星星打分</span>
	                <input type="hidden" id="star" value="1"/>
	                <input type="hidden" id="addr_id" value=""/>
	            </div>
	        </div>
	        <div class="comment-row">
	            <div class="comment-content vt-top">
	                <textarea id="comment-text" style="width: 90%; height: 100px;" placeholder="场地怎样？来点评一下吧！">郁闷</textarea>
	                <span class="comment-text-notice"></span>
	            </div>
	        </div>
		</div>
	</body>
</html>